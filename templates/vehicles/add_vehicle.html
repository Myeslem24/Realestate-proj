{% load static %}
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ğŸš— Ø¥Ø¶Ø§ÙØ© Ø³ÙŠØ§Ø±Ø©</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #f8f9fa;
    }
    .form-section {
      background: white;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      max-width: 700px;
      margin: auto;
    }
    label {
      font-weight: bold;
    }
  </style>
</head>
<body>

<div class="container my-5">
  <a href="{% url 'home' %}" class="btn btn-secondary mb-4">ğŸ  Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>

  <div class="form-section">
    <h3 class="text-center mb-4">ğŸš— Ø¥Ø¶Ø§ÙØ© Ø³ÙŠØ§Ø±Ø©</h3>

<form method="post" enctype="multipart/form-data">
  {% csrf_token %}
  {{ form.non_field_errors }}

  {% for field in form %}
    <div class="mb-3">
      <label>{{ field.label }}</label>
      {{ field }}
      {% if field.errors %}
        <div class="text-danger small">{{ field.errors|striptags }}</div>
      {% endif %}
    </div>
  {% endfor %}

  <hr class="my-4">
  <h5>ğŸ“¸ ØµÙˆØ± Ø¥Ø¶Ø§ÙÙŠØ© (Ø­ØªÙ‰ 3 ØµÙˆØ±):</h5>

  {{ formset.management_form }}
  {% for media_form in formset %}
    <div class="mb-3">
      {{ media_form.image.label_tag }}  
      {{ media_form.image }}
      {% if media_form.errors %}
        <div class="text-danger small">{{ media_form.errors|striptags }}</div>
      {% endif %}
    </div>
  {% endfor %}

  <button type="submit" class="btn btn-primary w-100">ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</button>
</form>

  </div>
</div>

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- AJAX Ù„Ø¬Ù„Ø¨ Ø§Ù„Ø·Ø±Ø§Ø²Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø´Ø±ÙƒØ© -->
<script>
  $(document).ready(function() {
    $('#id_brand').on('change', function() {
      const brandId = $(this).val();
      const modelSelect = $('#id_model');

      if (brandId) {
        $.ajax({
          url: "{% url 'get_car_models' %}",
          data: { brand_id: brandId },
          dataType: 'json',
          success: function(data) {
            let options = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø·Ø±Ø§Ø²</option>';
            data.forEach(function(model) {
              options += `<option value="${model.id}">${model.name}</option>`;
            });
            modelSelect.html(options);
          },
          error: function() {
            modelSelect.html('<option value="">Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ø±Ø§Ø²Ø§Øª</option>');
          }
        });
      } else {
        modelSelect.html('<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø·Ø±Ø§Ø²</option>');
      }
    });

    // ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³Ø¨Ù‚ Ù„Ù„Ø·Ø±Ø§Ø²Ø§Øª Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ù‚ÙŠØ¯ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
    $('#id_brand').trigger('change');
  });
</script>

</body>
</html>
